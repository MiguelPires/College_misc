%\documentclass[•]{•}10pt,conference,compsocconf,letterpaper]{IEEEtran}
\documentclass[10pt,pdftex,a4paper]{article}%
% \pdfoutput=1
%\documentclass{sig-alternate-per}
%\documentclass{llncs}
%\usepackage{llncsdoc}
\usepackage{verbatim}
\usepackage{amssymb}
\usepackage{lipsum}
\usepackage{multicol}
%\usepackage{amsmath}
\usepackage{framed}
\usepackage{float}
\floatstyle{boxed} 
\restylefloat{figure}
\usepackage{subfig}
%\usepackage{mdframed}
%\usepackage{amsthm}
\usepackage{tikz}
\usepackage{hyperref}
\usepackage{color}
%\usepackage{fullpage}
\usepackage{enumitem}
\setlist{nolistsep}
%\setenumerate{itemsep=0pt}
\usepackage{tikz}
%\usepackage[margin=0.92in]{geometry}
\usepackage{cite}
\usepackage[textsize=tiny]{todonotes}

%\usepackage[dvips]{graphicx}
%\ifx\pdftexversion\undefined
%\usepackage[dvips]{graphicx}
%\else
%  \usepackage[pdftex]{graphicx}
%  \DeclareGraphicsRule{*}{mps}{*}{}
%\fi
\newif\ifcode
\codefalse
%%%
% comment this if you do not have
% algpseudocode package for algorithms.
\codetrue
%%%
\usepackage{macros}
\ifcode
\usepackage[ruled]{algorithm}
\usepackage{algpseudocode}
\usepackage{ioa_code}

\usepackage{xcolor,colortbl}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%=
%%%%%%%%%%%%%%%%%%%%%%%%%%
%pour avoir plus de place
% \topmargin 0pt
% \advance \topmargin by -\headheight
% \advance \topmargin by -\headsep
% \textheight 8.9in
% \oddsidemargin 0pt
% \evensidemargin \oddsidemargin
% \marginparwidth 0.5in
% \textwidth 6.5in
% \setlength{\baselineskip}{13.2pt} % standard value is 13.75pt
\def\algofont{\footnotesize} %fonte pour les algos
%\interfootnotelinepenalty=10
%fin de pour avoir plus de place
%du coup il faut commenter la suite
%\textwidth 130mm
%\textheight 215mm
%jusqu'ici
%\renewcommand{\baselinestretch}{1.5}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definitions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtheorem{theorem}{Theorem}
% %\newtheorem{reptheorem}[]{Theorem \ref{th:sl}}
% %\newreptheorem{theorem}{Theorem}
% \newtheorem{axiom}[theorem]{Axiom}
% \newtheorem{case}[theorem]{Case}
%\newtheorem{claim}[theorem]{Claim}
% \newtheorem{proposition}{Proposition}
% \newtheorem{explanation}[theorem]{Explanation}
% \newtheorem{remark}[theorem]{Remark}
% \newtheorem{fact}[theorem]{Fact}
% % \newtheorem{conclusion}[theorem]{Conclusion}
% % \newtheorem{condition}[theorem]{Condition}
% \newtheorem{conjecture}[theorem]{Conjecture}
% \newtheorem{corollary}[theorem]{Corollary}
% % \newtheorem{criterion}[theorem]{Criterion}
% \newtheorem{definition}{Definition}
% % \newtheorem{exercise}[theorem]{Exercise}
% \newtheorem{lemma}[theorem]{Lemma}
% % \newtheorem{notation}[theorem]{Notation}
% % \newtheorem{problem}[theorem]{Problem}
% %\newtheorem{proposition}[theorem]{Proposition}
% % \newtheorem{remark}[theorem]{Remark}
% % \newtheorem{solution}[theorem]{Solution}
% % \newtheorem{summary}[theorem]{Summary}
% \newtheorem{observation}[theorem]{Observation}
% %\newenvironment{proof}[1][Proof]{\noindent\textbf{#1.} }{\hfill $\Box$\\[2mm]} %\rule{0.5em}{0.5em}\\}
% %\newenvironment{proofsketch}[1][Proof sketch]{\noindent\textbf{#1.} }{\hfill $\Box$\\[2mm]} %\rule{0.5em}{0.5em}\\}
% 
% \newenvironment{reptheorem}[1][Theorem]{\noindent\textbf{#1}}{}
% \def\lf{\tiny}
% \def\rrnnll{\setcounter{linenumber}{0}}
% \def\nnll{\refstepcounter{linenumber}\lf\thelinenumber}
% \newcounter{linenumber}
% \newenvironment{algorithmfig}{\hrule\vskip 3mm}{ \vskip 3mm \hrule }

\def\P{\ensuremath{\mathcal{P}}}
\def\DP{\ensuremath{\Diamond\mathcal{P}}}
\def\DS{\ensuremath{\Diamond\mathcal{S}}}
%\def\T{\ensuremath{\mathcal{T}}}
\def\Time{\mathbb{T}}
\def\S{\ensuremath{\mathcal{S}}}
\def\D{\ensuremath{\mathcal{D}}}
\def\W{\ensuremath{\mathcal{W}}}
\def\A{\ensuremath{\mathcal{A}}}
\def\B{\ensuremath{\mathcal{B}}}
\def\F{\ensuremath{\mathcal{F}}}
\def\R{\ensuremath{\mathcal{R}}}
\def\N{\ensuremath{\mathcal{N}}}
\def\I{\ensuremath{\mathcal{I}}}
\def\O{\ensuremath{\mathcal{O}}}
\def\Q{\ensuremath{\mathcal{Q}}}
\def\K{\ensuremath{\mathcal{K}}}
\def\L{\ensuremath{\mathcal{L}}}
\def\M{\ensuremath{\mathcal{M}}}
\def\V{\ensuremath{\mathcal{V}}}
\def\E{\ensuremath{\mathcal{E}}}
\def\C{\ensuremath{\mathcal{C}}}
\def\T{\ensuremath{\mathcal{T}}}
\def\X{\ensuremath{\mathcal{X}}}
\def\Y{\ensuremath{\mathcal{Y}}}
\def\Nat{\ensuremath{\mathbb{N}}}
\def\Om{\ensuremath{\Omega}}
\def\ve{\varepsilon}
\def\fd{failure detector}
\def\cfd{\ensuremath{?\P+\DS}}
\def\afd{timeless}
\def\env{\ensuremath{\mathcal{E}}}
%\def\faulty{unreliable}
\def\bounded{one-shot}
\def\cons{\textit{cons}}
\def\val{\textit{val}}
\def\code{\textit{code}}

\def\HSS{\mathit{h}}
\def\argmin{\mathit{argmin}}
\def\proper{\mathit{proper}}
\def\content{\mathit{content}}
\def\Level{\mathit{L}}
\def\Blocked{\mathit{Blocked}}
\def\Set{\mathit{Set}}
\def\TS{\mathit{TS}}
\def\shared{\mathit{shared}}
\def\exclusive{\mathit{exclusive}}

\newcommand{\correct}{\mathit{correct}}
\newcommand{\RNum}[1]{\uppercase\expandafter{\romannumeral #1\relax}}
\newcommand	{\faulty}{\mathit{faulty}}
\newcommand{\infi}{\mathit{inf}}
\newcommand{\live}{\mathit{live}}
\newcommand{\true}{\mathit{true}}
\newcommand{\false}{\mathit{false}}
\newcommand{\stable}{\mathit{Stable}}
\newcommand{\setcon}{\mathit{setcon}}
\newcommand{\remove}[1]{}

\newcommand{\Wset}{\textit{Wset}}
\newcommand{\Rset}{\textit{Rset}}
\newcommand{\Dset}{\textit{Dset}}

%\newcommand{\parts}{\textit{parts}}
\newcommand{\txns}{\textit{txns}}

\newcommand{\Read}{\textit{read}}
\newcommand{\Write}{\textit{write}}
\newcommand{\TryC}{\textit{tryC}}
\newcommand{\TryA}{\textit{tryA}}
\newcommand{\ok}{\textit{ok}}

\newcommand{\trylock}{\textit{trylock}}
\newcommand{\multitrylock}{\textit{multi-trylock}}
\newcommand{\CAS}{\textit{CAS}}
\newcommand{\mCAS}{\textit{mCAS}}

\def\Nomega{\ensuremath{\neg\Omega}}
\def\Vomega{\ensuremath{\overrightarrow{\Omega}}}

\newcommand{\id}[1]{\mbox{\textit{#1}}}% for identifiers in code
\newcommand{\res}[1]{\mbox{\textbf{#1}}}% reserved words

\newcommand{\ignore}[1]{}

\begin{document}
\bibliographystyle{abbrv}

\title{Relaxed consistency models for geo-distributed systems}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\date{}
\maketitle
%
%
\begin{abstract}
%
\end{abstract}
%
Distributed protocols for building stateful fault-tolerant applications in data centers typically strive to provide strong consistency \`a la \emph{linearizability}~\cite{Her91}.
However, the complexity of achieving consistent replication of state while ensuring availability makes it hard to justify its deployment in \emph{geo-distributed data centers}.
The increasing popularity of replicating online services across diverse data centers emphasizes 
the need for low-latency protocols that cater to failure patterns specific to such a setting while still maintaining 
some \emph{relaxed} form of \emph{cross-site consistency}. There is a need for constructing modular protocols for state-machine replication
in such geo-distributed settings that are tunable to specific consistency levels and failure patterns.
%
\par 
{\color{red} TODO: Write assumptions and properties}

\begin{algorithm}
\caption{Generalized Paxos - Proposer p}
\textbf{Local variables:} $ballot_l = 0,\ maxTried_l = \bot,\ C_l = \bot,\ timer = \bot,\ quorumSize = 0,\ messages = \bot,\ previousMessages = \bot, collected = False$
\begin{algorithmic}[1]

    \Function{Propose}{\textit{C}}
    \If{fast\_ballot}
        \State \textbf{run} \Call{phase\_1a}{fast,\textit{C}};
    \Else
        \State \textbf{run} \Call{send}{\textit{propose, C}} to Leader;
    \EndIf
    \EndFunction
        
    \State
    \State \textbf{upon} \textit{receive(propose, C)} from proposer $p_i$ \textbf{do} 
        \State \hspace{\algorithmicindent} \textbf{if} $p = Leader$ \textbf{then}
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent} \textbf{run} \Call{phase\_1a}{slow, C};
    
    \State
    \State \textbf{upon} \textit{receive(statement)} from proposer $p_i$ \textbf{do}
    \State \hspace{\algorithmicindent} $messages[p_i] = statement$;
    
    \State
    \State \textbf{upon} $timer$ \textbf{do} 
    \State \hspace{\algorithmicindent} $quorumSize = n-u$;

    \State     
    \State \textbf{upon} $\#(messages) \geq quorumSize \land collected = False$ \textbf{do} 
        \State \hspace{\algorithmicindent} \textbf{if }{$\#(messages) < n-s \land verification = False$} \textbf{then}
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent} $quorumSize = n-f$;
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent}
            $previousMessages = messages$;
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent}
            $messages = \bot$;
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent} $verification = True$;
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent} $timer = \textbf{run}\ \Call{start\_timer}{2T}$;

        \State \hspace{\algorithmicindent} \textbf{else}
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent} $collected = True$;
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent} \textbf{if}\ $messageRound = p1b$ \textbf{then}
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent}\hspace{\algorithmicindent} 
            \textbf{run} \Call{phase\_2a}{$ballot_l, Q$};
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent} \textbf{else}
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent}\hspace{\algorithmicindent} \textbf{run} \Call{send}{$p2b, message.bal, message.val$} to learners;
            
        
            
    \State
    \State \textbf{upon} $verification = True \land collected = False \land (\#(messages) \geq quorumSize \lor \#(messages \cup previousMessages) \geq n-s)$ \textbf{do}
    \State \hspace{\algorithmicindent} $collected = True$;
    \State\ \hspace{\algorithmicindent}\textbf{if}\ $messageRound = p1b$ \textbf{then}
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent} 
            \textbf{run} \Call{phase\_2a}{$ballot_l, Q$};
            \State \hspace{\algorithmicindent} \textbf{else}
            \State \hspace{\algorithmicindent}\hspace{\algorithmicindent} \textbf{run} \Call{send}{$p2b, message.bal, message.val$} to learners;

\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Generalized Paxos - Proposer p (continued)}
\begin{algorithmic}[1]
    %\item[] % unnumbered empty line
    \Function{Phase\_1a}{ballot\_type, C}
        \State $C_l = C$;
        \State $quorumSize = n-s$;
        \State $timer$ = \textbf{run} \Call{start\_Timer}{2T};
        
        \State
        \If{ballot\_type = fast}
            \State \textbf{run} \Call{send}{$fast, ballot_l$} to Acceptors;
        \Else
            \State \textbf{run} \Call{send}{$p1a, ballot_l$} to Acceptors;
        \EndIf
    \EndFunction
    
    \State
    \Function{Phase\_2a}{$bal, Q$}
        \State $maxTried_l$ = \textbf{run} \Call{Proved\_Safe}{$Q, bal$};
        \State $maxTried_l = maxTried_l \bullet C_l$;
        \State \textbf{run} \Call{send}{$p2a,ballot_l, maxTried_l$} to Acceptors;
    \EndFunction
    
    \State
    \Function{Proved\_Safe}{Q, m}
        \State $k = max(i\ |\ (i < m) \wedge (\exists a \in Q :\ val_a[i]\ \neq null))$;
        \State $RS = \{R \in k$-$quorum\ |\ \forall a \in R \cap Q : val_a[k] \neq null\}$;
        
        \State
        \If{$RS = \varnothing$}
            \State \textbf{return} $\{val_a[k]\ |\ (a \in Q) \wedge (val_a[k] \neq null)\}$;
        \Else
            \State \textbf{return} \textbf{run} $lowerUpperBound(val_a[k]\ |\ a \in Q \cap R$);
            
        \EndIf
    \EndFunction
        
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Generalized Paxos - Acceptor a}
\textbf{Local variables: } $bal_a = 0,\ mbal_a = 0, \val_a = \bot$ 
\begin{algorithmic}[1]
  
  \State \textbf{upon} \textit{receive(fast, val)} from proposer \textit{p} \textbf{do}
    \State \hspace{\algorithmicindent} \textbf{run} \Call{phase\_2b\_fast}{$val, p$};
    
    \State
    \State \textbf{upon} \textit{receive(p1a, ballot)} from leader \textit{l} \textbf{do}
    \State \hspace{\algorithmicindent} \textbf{run} \Call{phase\_1b}{$ballot, l$};
    
    \State
    \State \textbf{upon} \textit{receive(p2a, ballot, value)} from leader \textit{l} \textbf{do}
    \State \hspace{\algorithmicindent} \textbf{run} \Call{phase\_2b\_classic}{$ballot, value, l$};
    
    \State
    \Function{Phase\_1b}{$m, l$}
        \If {$bal_a < m$}
            \State $bal_a = m$;
            \State \Call{send}{$p1b, m, mbal_a, val_a$} to leader l;
        \EndIf
    \EndFunction
    
    \State
    \Function{Phase\_2b\_Classic}{$m, u, l$}
        \State $k = max(i\ |\ (i < m) \wedge (\exists a \in Q :\ val_a[i]\ \neq null))$;
        \If {$m \geq k$}
            \State $val_a = u$;
            \State \Call{send}{$p2b, bal_a, val_a$} to leader l;
        \EndIf
    \EndFunction
    
    \State
    \Function{Phase\_2b\_Fast}{$u, p$}
        \State $k = max(i\ |\ (i < m) \wedge (\exists a \in Q :\ val_a[i]\ \neq null))$;
        \If {$bal_a == k$}
            \State $val_a = val_a \bullet u$;
            \State \Call{send}{$p2b, bal_a, val_a$} to process p;
        \EndIf
    \EndFunction
    
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Generalized Paxos - Learner l}
\textbf{Local variables: } $learned = \varnothing$ 
\begin{algorithmic}[1]
  
    \State \textbf{upon} $receive (p2b, bal, val)$ from proposer p \textbf{do}
        \State \hspace{\algorithmicindent} $learned = learned \cup val$;
\end{algorithmic}
\end{algorithm}

\pagenumbering{arabic}\setcounter{page}{1}

\bibliography{references}
\end{document}
%%% Local Variables:
%%% mode: latex
%%% mode: flyspell
%%% Local IspellDict: "american"
%%% mode: outline-minor
%%% End:

