\section{Protocol} 

The Visigoth model differs from its Byzantine counterpart by allowing $s$ processes to be slow but correct \cite{Porto2015}. A process $i$ is defined to be slow with respect to $j$ if messages from $i$ to $j$ (or vice-versa) take more than $T$ time units to be transmitted. This assumption allows us to gather more efficient quorums by leveraging the knowledge that only $s$ processes can take more than $T$ time units to send and process a message. In VFT's Quorum Gathering Primitive (QGP), a process gathers a quorum by waiting for messages from $N-s$ distinct processes. Since the Visigoth model provides a bound on the time messages from correct processes take to be transmitted, a gatherer process can set a timer that allows all correct and non-slow  messages to be delivered. After a timeout occurs, of the $x$ processes that are unresponsive, only $s$ of them may be slow, which means that $x-s$ processes must be faulty. This allows us to leverage the assumption of $s$ slow but correct processes to decrease the quorum size to $N-u$ while still guaranteeing the intersection properties necessary for safety. We make use of this mechanism to adapt our Byzantine Generalized Paxos protocol to the Visigoth fault model. This includes changing the quorum gathering in phase 1b, where acceptors relay their previous votes to the leader, and phase 2b, where acceptors send their votes to the learners. \par
In our previous revisions of the Generalized Paxos protocol, we managed to deal with the particularities of each model without altering the message pattern, preserving the original protocol structure even in the presence of Byzantine failures. However, since we wish to use the QGP to take full advantage of the Visigoth model, the presence of Byzantine failures makes it necessary to slightly modify the message pattern. In Byzantine Generalized Paxos, a Byzantine leader can at most prevent progress until a new leader is elected. Even if a leader causes a split vote by sending different values to some acceptors in its phase 2a messages, at most one of those values can obtain the $N-u$ votes required to be learned. However, since in the Visigoth model we want to take advantage of the additional assumptions to reduce the quorum to $N-u$, it becomes possible for the leader to attempt a split vote by sending two different values to two sets of acceptors and ignoring others such that the ignored acceptors are more than $s$ and the timeout is reached, causing the required quorum size to be reduced. Since $o$ of the remaining acceptors can behave arbitrarily and vote for both values and the leader could attempt a split vote between the remaining $u+s+1$ (including the acceptors that were previously ignored), there are enough votes for both values to be committed, violating the safety property. One configuration where this would happen would be with $u=o=2,\ s=1,\ N=u+o+\min(u,s)+1=6$. In this system the initial quorum is $N-s=5$ and the reduced quorum is $N-u=4$. If the leader sends $v_1$ to two acceptors (one correct and one faulty), $v_2$ to other two (also one correct and one faulty) and ignores the last two, then the timeout is reached and the required quorum size is reduced from 5 to 4. In this case, each value has two votes from both of the Byzantine acceptors and one vote from one of the two correct acceptors that received the split vote. Since the previously ignored acceptors are correct, the leader can employ another split vote to divide them between $v_1$ and $v_2$ to achieve four votes for both values. \par
To prevent this situation, when sending phase 2b messages to learners, acceptors also resend the leader's phase 2a message to all other acceptors. This prevents the leader from purposely ignoring acceptors to force the quorum to decrease. To ensure that this replayed message originated from the leader and not from a Byzantine acceptor, it must include the leader's signature. This all-to-all replay between acceptors is broadcasted in parallel with the sending of phase $2b$ messages and, therefore doesn't require any additional delay in the common case where the leader is correct. If an acceptor that hasn't received a phase $2a$ message from the leader receives a replay from an acceptor, it validates that the signature originated from the leader and sends its vote the learners.

\subsection{Timings}

One important aspect of the original Visigoth description is related to the setting of timeouts. In VFT, all processes are expected to initiate the quorum gathering so they may commit a value. The timeouts used by the Quorum Gathering Primitive to trigger the quorum reduction must be set according to both the upper bound on message latency between processes and the maximum relative delay that can be expected between two processes initiating the primitive. This is encoded in the following property guaranteed by Quorum Gathering Primitive: \par

\begin{displayquote}
\textit{Safety-Intersection}: if there are two instances of QGP, such that all correct processes that are not crashed and not slow towards the respective gatherer processes initiate the protocol within $\delta$ time window such that $T+\delta < T_{QGP}$, then, if the two correct gatherers $p$ and $p'$ gather $M$ and $M'$ respectively, $M$ and $M'$ intersect in at least one correct replica.
\end{displayquote}

This specification is directly related to the fact that all correct processes are expected to gather messages from a quorum, which is why the timeout value $T{QGP}$ must be larger than the synchrony bound $T$ plus the maximum time that can elapse between two processes initiating the gathering process $\delta$. However, since in our system model processes are differentiated by roles as in traditional Paxos, it only makes sense to have the gathering logic at the learners. This difference in system modeling requires us to reason about the maximum delay that can be displayed between two votes sent from the acceptors to the learners. Take the worst case scenario where two message paths display the biggest possible latency difference after being sent by the leader: in the first case, the phase $2a$ message reaches an acceptor almost immediately and triggers the sending of a phase $2b$ message that also reaches the learner almost immediately; the second message takes the maximum amount of time $T$ that a non-faulty and non-slow message can take to reach some acceptors. Consider that the leader is also Byzantine and ignores a subset of the acceptors. Due to this behavior, some acceptors will have to wait from the replay broadcast sent by other acceptors to be aware of the phase $2a$ messages. Suppose that both this message round and the corresponding phase $2b$ message that it triggers take $T$ time units to reach the intended recipients. In this case, a total of $3T$ message delays will separate the two message paths without either of them being faulty or slow. Therefore, the timeout value $T_{QGP}$ at the learners must be set to $3T$.