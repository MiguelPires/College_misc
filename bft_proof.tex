\subsection{Correctness Proofs}

This section argues for the correctness of the Byzantine Generalized Paxos protocol in terms of the specified consensus properties.\par


\begin{table}[h!]
	\renewcommand{\arraystretch}{1.5}
	\centering
	\begin{tabularx}{\linewidth}{ |c|X|}
		%\hline
		%\multicolumn{2}{|c|}{Notation}\\
		\hline
		Invariant/Symbol & Definition \\
		\hline
		$\thicksim$ & Equivalence relation between sequences \\
		\hline
		$X \overset{e}{\implies} Y$ & $X$ implies that $Y$ is eventually true \\
		\hline
		$X \sqsubseteq Y$ & The sequence $X$ is either equivalent or a strict prefix of sequence $Y$ according to the equivalence relation $\thicksim$ \\
		\hline
		$\oplus$ & Exclusive OR (XOR) logic operator \\
		\hline
		$\mathcal{L}$ & Set of learner processes \\
		\hline
		$\mathcal{P}$ & Set of proposals (commands or sequences of commands) \\
		\hline
		$\mathcal{B}$ & Set of possible ballots \\
		\hline
		$learned_{l_i}$ & Learner $l_i$'s $learned$ sequence of commands \\
		\hline
		$learned(l_i,b,s)$ & $learned_{l_i}$ contains the sequence $s$\\
		\hline
		$maj\_accepted(b,s)$ & At least $N-f$ acceptors broadcasted their acceptance votes to the learners\\
		\hline
		$proposed(b,s)$ & A proposer proposed $s$ in ballot $b$ \\
		\hline
		
  	\end{tabularx} 
	\caption{Proof notation} 
	\label{table:1}
\end{table}

\subsubsection{Consistency}
\begin{theorem}At any time and for any two correct learners $l_i$ and $l_j$, $learned_{l_i}$ and $learned_{l_j}$ can subsequently be extended to equivalent sequences \par
\end{theorem} 
\textbf{Proof:} \par
1. $learned(l_j,b,s) \land learned(l_i,b,s') \implies s \sqsubseteq s' \lor s' \sqsubseteq s, \forall b \in \mathcal{B}, \forall s,s' \in \mathcal{P}$ \par
\indent\indent\textbf{Proof:} \par
\indent\indent\indent\parbox{\linewidth}{2.1. $learned(l_i,b,s) \land learned(l_j,b,s') \implies maj\_accepted(b,s) \land maj\_accepted(b,s'), \forall b \in \mathcal{B}, \forall s,s' \in \mathcal{P}$ } \par
\indent\indent\indent\indent\parbox{\linewidth}{\textbf{Proof:} By Algorithm \ref{BFT-Acc} lines \{20-31\} and Algorithm \ref{BFT-Learn} lines \{1-4\}, if a correct learner learned a sequence $s$ in a ballot $b$ then a $N-f$ acceptors must have executed phase $2b$ for $s$ in the same ballot.}\par
\indent\indent\indent\parbox{\linewidth}{2.2. $maj\_accepted(b,s)\ \land\ maj\_accepted(b,s') \implies s \sqsubseteq s' \lor s' \sqsubseteq s, \forall b \in \mathcal{B}, \forall s,s' \in \mathcal{P}$}\par
\indent\indent\indent\indent\textbf{Proof:} Proved by contradiction.\par
\indent\indent\indent\indent\indent\parbox{\linewidth}{2.2.1. $maj\_accepted(b,s) \land maj\_accepted(b,s') \implies s \not\sqsubseteq s' \land s' \not\sqsubseteq s, \forall b \in \mathcal{B}, \forall s,s' \in \mathcal{P}$} \par
\indent\indent\indent\indent\indent\indent\textbf{Proof:} Contradiction assumption.\par
\indent\indent\indent\indent\indent 2.2.2. $s$ and $s'$ are assembled concurrently \par
\indent\indent\indent\indent\indent\indent \parbox{\linewidth}{\textbf{Proof:} By Algorithm \ref{BFT-Acc} lines \{27-31\}, if $\not\sqsubseteq s' \land s' \not\sqsubseteq s$ then they must contain non-commutative commands and have been assembled concurrently.}\par
\indent\indent\indent\indent\indent 2.2.3. $maj\_accepted(b,s) \oplus maj\_accepted(b,s')$ \par
\indent\indent\indent\indent\indent\indent \parbox{\linewidth}{\textbf{Proof:} By 2 and Algorithm \ref{BFT-Learn} lines \{1-4\}, only $s$ or $s'$ can gather $N-f$ votes.}\par
\indent\indent\indent\indent\indent 2.2.4. Q.E.D. \par
\indent\indent\indent 2.3. $learned(l_i,b,s)\ \land\ learned(l_j,b,s') \implies s \sqsubseteq s' \lor s' \sqsubseteq s, \forall b \in \mathcal{B}, \forall s,s' \in \mathcal{P}$ \par
\indent\indent\indent\indent\textbf{Proof:} By 1 and 2.\par
\indent\indent\indent 2.4. Q.E.D. \par
\parbox{\linewidth}{2. $learned(l_j,b,learned_i) \land learned(l_i,b,learned_j) \implies learned_i \sqsubseteq learned_j \lor learned_j' \sqsubseteq learned_i, \forall b \in \mathcal{B}, \forall l_i,l_j \in \mathcal{L}$}\par
\indent\indent\textbf{Proof:} By 1.\par
3. Q.E.D. \par

\subsubsection{Non-Triviality}
\begin{theorem}
$learned_l$ can only contain proposed commands \label{N-T1} \par
\end{theorem} 
\textbf{Proof:} \par
1. $learned(l_i,b,s) \implies maj\_accepted(b,s),\forall l_i \in \mathcal{L}, \forall b \in \mathcal{B}, \forall s \in \mathcal{P}$ \par
\indent\indent\parbox{\linewidth}{\textbf{Proof:} By Algorithm \ref{BFT-Acc} lines \{20-31\} and Algorithm \ref{BFT-Learn} lines \{1-4\}, if a correct learner learned a sequence $s$ in a ballot $b$ then $N-f$ acceptors must have executed phase $2b$ for $s$ in the same ballot.}. \par
2. $maj\_accepted(b,s) \implies proposed(b,s),\forall b \in \mathcal{B}, \forall s \in \mathcal{P}$ \par
\indent\indent\textbf{Proof:} By Algorithm \ref{BFT-Acc} lines \{7-11, 20-31\}, for $N-f$ acceptors to accept a proposal it must have been proposed by a proposer.\par
3. $learned(l_i,b,s) \implies proposed(b,s),\forall l_i \in \mathcal{L}, \forall b \in \mathcal{B}, \forall s \in \mathcal{P}$ \par
\indent\indent\textbf{Proof:} By 1 and 2. \par
4. Q.E.D. \par

\subsubsection{Stability}
\begin{theorem}
If $learned_l = v$ then, at all later times, $v \sqsubseteq learned_l$, for any $l$ and $v$ \par \label{S-T1}
\end{theorem} 
\textbf{Proof:} By Algorithm \ref{BFT-Learn} lines \{1-4\}, a correct learner can only append new commands to its $learned$ command sequence.

\subsubsection{Liveness}
\begin{theorem}
For any proposal $s$ and correct learner $l$, eventually $learned_l$ contains $s$ \label{L-T1} \par
\end{theorem} 
\textbf{Proof:} \par
1. $maj\_accepted(b,s) \overset{e}{\implies} learned(l_i,b,s),\ \forall\ l_i \in \mathcal{L}, \forall b \in \mathcal{B}, \forall s \in \mathcal{P}$ \par
\indent\indent\parbox{\linewidth}{\textbf{Proof:} By Algorithm \ref{BFT-Acc} lines \{20-31\} and Algorithm \ref{BFT-Learn} lines \{1-4\}, when $N-f$ acceptors accepts a sequence $s$ (or some equivalent sequence) in ballot $b$, eventually $s$ will be learned by any correct learner during ballot $b$.}\par
2. $proposed(s) \overset{e}{\implies} maj\_accepted(b,s), \forall b \in \mathcal{B}, \forall s \in \mathcal{P}$ \par
\indent\indent\parbox{\linewidth}{\textbf{Proof:} A proposed sequence is either conflict-free when its incorporated into every acceptor's current sequence or it's creates conflicting sequences at different acceptors. In the first case, it's accepted by a quorum (Algorithm \ref{BFT-Acc} lines \{27-31\}) and, in the second case, it's sent in phase $1b$ messages to the in leader in the next ballot (Algorithm \ref{BFT-Acc} lines \{13-18\}) and incorporated in the next proposal (Algorithm \ref{BFT-Lead} lines \{8-14,27-36\}).} \par
3. $proposed(s) \overset{e}{\implies} learned(l_i,b,s),\ \forall l_i \in \mathcal{L},\forall b \in \mathcal{B}, \forall s \in \mathcal{P}$ \par
\indent\indent\textbf{Proof:} By 1 and 2. \par
4. Q.E.D.